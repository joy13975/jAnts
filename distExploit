#!/bin/bash

free_hosts=$(scanFreeHosts jtruck)
n_free_hosts=$(echo "${free_hosts[@]}" | wc -w)
echo "There are $n_free_hosts jtruck-free hosts:"
echo ${free_hosts[@]}

echo "Use first N machines: "
read maxMachines
if [[ $maxMachines -gt $n_free_hosts ]]; then
    maxMachines=$n_free_hosts
fi
params=$(cat goodParams.txt)

free_hosts=( $free_hosts )
for ((i=0;i<$maxMachines;i++)); do
    host=${free_hosts[$i]}
    randSeed=$((1 + RANDOM % 1337))
    job="cd src/JTruck; screen -dm ./jtruck $params -rs $randSeed -o distOutputs/$host.txt"
    cmd="goto $host "'"'$job'"'

    echo "Sending job to $host"
#   echo Command is: "$cmd"
    goto $host "$job"
done
